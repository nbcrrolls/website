<html>
  <head>
    <script type="text/javascript" src="http://canvg.googlecode.com/svn/trunk/rgbcolor.js"></script> 
    <script type="text/javascript" src="http://canvg.googlecode.com/svn/trunk/canvg.js"></script>
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script type="text/javascript" src="base.js"> </script>

    <script type="text/javascript">
      // Define variables for the charts 

        // APBS registered users by year
        var data1 = new google.visualization.DataTable();
        data1.addColumn({ type: 'string', label: 'Labels' });
        data1.addColumn({ type: 'number', label: 'Count' });
        data1.addColumn({ type: 'number', label: '' });
        data1.addColumn({ type: 'string', role: 'annotation' });

        var options1 = {
            width: 400, 
            height: 360, 
            title: 'Registered users of APBS',
            colors: ['#3b96ce'],
            hAxis: {title: 'Year', textStyle: {color: 'black', fontSize: 11}},
            vAxis: {title: 'Count', textStyle: {color: 'black', fontSize: 11}},
            series: [{ type: 'bars',  visibleInLegend:false },
                    { type: 'line', color:'black', lineWidth: 0, visibleInLegend:false, pointSize: 0}]
        };

        // Website access world geographical distribution 
        var data2 = new google.visualization.DataTable();
        data2.addColumn('string', 'Country');
        data2.addColumn('number', 'Web service access ');

        var options2 = {
            resolution: "country",
            width: 400, 
            backgroundColor: "#FFFFFF",
            datalessRegionColor: "#EEE5E5",
            colorAxis: { colors : ['#b3e2f9','#0860b3' ], },
        };

      // Add data from stats
      function addData() {
        data1.addRows([
            ["2011", 15302, 15302, '15302'],
            ["2012", 17697, 17697, '17697'],
            ["2013", 19504, 19504, '19504'],
            ["2014", 21360, 21360, '21360'],
            ["2015", 21925, 21925, '21925'],
        ]);

        data2.addRows([
        ["Canada", 1223], ["Saudi Arabia", 35], ["Lithuania", 39], ["Cambodia", 1], ["Ethiopia", 6],
        ["Palestine", 3], ["Belize", 1], ["Argentina", 308], ["Bolivia", 1], ["Cameroon", 5],
        ["Ghana", 4], ["Slovenia", 81], ["Guatemala", 4], ["Jordan", 5], ["Spain", 717],
        ["Liberia", 1], ["Netherlands", 292], ["Jamaica", 2], ["Oman", 2], ["Tanzania", 3],
        ["Gabon", 1], ["Monaco", 1], ["Yemen", 1], ["Pakistan", 94], ["South Africa", 114],
        ["Albania", 1], ["Macau", 7], ["El Salvador", 1], ["Guam", 2], ["Kosovo", 2],
        ["India", 3487], ["Azerbaijan", 2], ["United States", 13910], ["Kenya", 92], ["Belarus", 6],
        ["Turkey", 258], ["Bangladesh", 42], ["Mongolia", 1], ["France", 1294], ["Rwanda", 4],
        ["Slovakia", 31], ["Somalia", 2], ["Peru", 33], ["Vatican City", 2], ["Norway", 255],
        ["Sri Lanka", 25], ["Singapore", 405], ["China", 1597], ["Armenia", 7], ["Ukraine", 93],
        ["Bahrain", 1], ["Finland", 141], ["Libya", 1], ["Indonesia", 155], ["Costa Rica", 3],
        ["Mauritius", 2], ["Sweden", 329], ["Vietnam", 98], ["Czech Republic", 267], ["Russia", 1192],
        ["United Arab Emirates", 17], ["Romania", 246], ["Angola", 1], ["Portugal", 333], ["Bosnia and Herzegovina", 1],
        ["Malaysia", 191], ["Austria", 359], ["Mozambique", 3], ["Uganda", 2], ["Hungary", 103],
        ["Niger", 1], ["Brazil", 1261], ["United Kingdom", 2445], ["Kuwait", 3], ["Panama", 2],
        ["Madagascar", 6], ["Luxembourg", 2], ["Ireland", 98], ["Nigeria", 13], ["Ecuador", 17],
        ["Brunei", 1], ["Australia", 768], ["Iran", 310], ["Algeria", 38], ["Chile", 398],
        ["Belgium", 330], ["Thailand", 335], ["Haiti", 1], ["Bulgaria", 39], ["Georgia", 10],
        ["Denmark", 273], ["Philippines", 80], ["Moldova", 10], ["Morocco", 10], ["Croatia", 132],
        ["Switzerland", 649], ["Grenada", 1], ["New Zealand", 120], ["Iraq", 4], ["Estonia", 13],
        ["Uruguay", 57], ["Lebanon", 3], ["Puerto Rico", 8], ["Egypt", 47], ["Colombia", 113],
        ["Taiwan", 389], ["Cyprus", 6], ["Barbados", 2], ["Qatar", 7], ["Dominican Republic", 6],
        ["Italy", 981], ["Bhutan", 1], ["Sudan", 3], ["Ivory Coast", 1], ["Nepal", 3],
        ["Malta", 2], ["Venezuela", 9], ["Israel", 259], ["Iceland", 7], ["Zambia", 1],
        ["Germany", 3406], ["Kazakhstan", 163], ["Poland", 523], ["Kyrgyzstan", 4], ["Macedonia", 6],
        ["South Korea", 662], ["Latvia", 17], ["Japan", 1755], ["Runion", 6], ["not set", 227],
        ["Honduras", 1], ["Trinidad and Tobago", 3], ["Myanmar", 2], ["Mexico", 944], ["Tunisia", 25],
        ["Cuba", 16], ["Serbia", 27], ["Hong Kong", 229], ["Greece", 92], ["Paraguay", 1],
        ["Namibia", 3], ["Botswana", 2],
        ]);

      };

      // Define charts drawing
      function drawChart() {
        addData();
  
        var chart1 = new google.visualization.ComboChart(document.getElementById('apbs1'));
        chart1.draw(data1, options1);

        var chart2 = new google.visualization.GeoChart(document.getElementById('apbs2'));
        chart2.draw(data2, options2);
      }

      // Draw charts
      google.setOnLoadCallback(drawChart);

    </script>
  </head>

  <body>
    <h3 align="center"><font color="#0082A0">APBS statistics</font></h3>
        <strong>Bar chart</strong>: the total number of registerd users of APBS.<br>
        <strong>Map</strong>: geographical distribution of <a href="http://www.poissonboltzmann.org">APBS website</a>
        visits, as tracked by google analytics over the calendar year. <br>For 2014 only half a year is available due
        to the loss of google analytics data.<br><br>
        Use <b>Convert</b> buttons to view an image in a frame below and 
        <b>Save</b> buttons to copy an image to your Desktop.<br>

    <!-- chart and map -->
    <div id="apbs1" style="width: 400px; height: 360px; float: left"></div>
    <div id="apbs2" style="width: 400px; height: 360px; float: left"></div>
    <br style="clear: left;" />

    <!-- chart buttons -->
    <button style="position:relative; left:60 " onclick="saveAsImg(document.getElementById('apbs1'));">
        Save chart as PNG image
    </button>
    <button style="position:relative; left:60" onclick="toImg(document.getElementById('apbs1'), document.getElementById('img_div'));">
        Convert chart to image
    </button>

    <!-- map buttons -->
    <button style="position:relative; left:200 " onclick="saveAsImg(document.getElementById('apbs2'));">
        Save map as PNG image
    </button>
    <button style="position:relative; left:200" onclick="toImg(document.getElementById('apbs2'), document.getElementById('img_div'));">
        Convert map to image
    </button>
    <br />

    <!-- "image placement" position  on the page-->
    <div id="img_div" style="width: 400px; position: relative; top:10;  z-index: 10; border: 1px solid #0082A0; color: #0082A0">
      Image will be placed here
    </div>

  </body>
</html>
